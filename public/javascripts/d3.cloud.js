!function(t){function n(){function t(t,e,r){for(var a,u,o,i=([{x:0,y:0},{x:n[0],y:n[1]}],e.x),f=e.y,l=Math.sqrt(n[0]*n[0]+n[1]*n[1]),h=w(n),y=Math.random()<.5?1:-1,x=-y;(a=h(x+=y))&&(u=~~a[0],o=~~a[1],!(Math.min(u,o)>l));)if(e.x=i+u,e.y=f+o,!(e.x+e.x0<0||e.y+e.y0<0||e.x+e.x1>n[0]||e.y+e.y1>n[1])&&(!r||!s(e,t,n[0]))&&(!r||c(e,r))){for(var d,g=e.sprite,v=e.width>>5,m=n[0]>>5,p=e.x-(v<<4),M=127&p,b=32-M,z=e.y1-e.y0,I=(e.y+e.y0)*m+(p>>5),k=0;z>k;k++){d=0;for(var T=0;v>=T;T++)t[I+T]|=d<<b|(v>T?(d=g[k*v+T])>>>M:0);I+=m}return delete e.sprite,!0}return!1}var n=[256,256],y=e,d=r,g=u,v=a,m=a,p=o,M=i,w=h,z=[],I=1/0,k=d3.dispatch("word","end"),T=null,q={};return q.start=function(){function e(){for(var e,c=+new Date;+new Date-c<I&&++o<u&&T;)e=s[o],e.x=n[0]*(Math.random()+.5)>>1,e.y=n[1]*(Math.random()+.5)>>1,f(e,s,o),e.hasText&&t(r,e,a)&&(i.push(e),k.word(e),a?l(a,e):a=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}],e.x-=n[0]>>1,e.y-=n[1]>>1);o>=u&&(q.stop(),k.end(i,a))}var r=x((n[0]>>5)*n[1]),a=null,u=z.length,o=-1,i=[],s=z.map(function(t,n){return t.text=y.call(this,t,n),t.font=d.call(this,t,n),t.style=v.call(this,t,n),t.weight=m.call(this,t,n),t.rotate=p.call(this,t,n),t.size=~~g.call(this,t,n),t.padding=M.call(this,t,n),t}).sort(function(t,n){return n.size-t.size});return T&&clearInterval(T),T=setInterval(e,0),e(),q},q.stop=function(){return T&&(clearInterval(T),T=null),q},q.timeInterval=function(t){return arguments.length?(I=null==t?1/0:t,q):I},q.words=function(t){return arguments.length?(z=t,q):z},q.size=function(t){return arguments.length?(n=[+t[0],+t[1]],q):n},q.font=function(t){return arguments.length?(d=d3.functor(t),q):d},q.fontStyle=function(t){return arguments.length?(v=d3.functor(t),q):v},q.fontWeight=function(t){return arguments.length?(m=d3.functor(t),q):m},q.rotate=function(t){return arguments.length?(p=d3.functor(t),q):p},q.text=function(t){return arguments.length?(y=d3.functor(t),q):y},q.spiral=function(t){return arguments.length?(w=b[t+""]||t,q):w},q.fontSize=function(t){return arguments.length?(g=d3.functor(t),q):g},q.padding=function(t){return arguments.length?(M=d3.functor(t),q):M},d3.rebind(q,k,"on")}function e(t){return t.text}function r(){return"serif"}function a(){return"normal"}function u(t){return Math.sqrt(t.value)}function o(){return 30*(~~(6*Math.random())-3)}function i(){return 1}function f(t,n,e){if(!t.sprite){w.clearRect(0,0,(v<<5)/p,m/p);var r=0,a=0,u=0,o=n.length;for(--e;++e<o;){t=n[e],w.save(),w.font=t.style+" "+t.weight+" "+~~((t.size+1)/p)+"px "+t.font;var i=w.measureText(t.text+"m").width*p,f=t.size<<1;if(t.rotate){var s=Math.sin(t.rotate*g),l=Math.cos(t.rotate*g),c=i*l,h=i*s,y=f*l,x=f*s;i=Math.max(Math.abs(c+x),Math.abs(c-x))+31>>5<<5,f=~~Math.max(Math.abs(h+y),Math.abs(h-y))}else i=i+31>>5<<5;if(f>u&&(u=f),r+i>=v<<5&&(r=0,a+=u,u=0),a+f>=m)break;w.translate((r+(i>>1))/p,(a+(f>>1))/p),t.rotate&&w.rotate(t.rotate*g),w.fillText(t.text,0,0),t.padding&&(w.lineWidth=2*t.padding,w.strokeText(t.text,0,0)),w.restore(),t.width=i,t.height=f,t.xoff=r,t.yoff=a,t.x1=i>>1,t.y1=f>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,r+=i}for(var d=w.getImageData(0,0,(v<<5)/p,m/p).data,M=[];--e>=0;)if(t=n[e],t.hasText){for(var i=t.width,b=i>>5,f=t.y1-t.y0,z=0;f*b>z;z++)M[z]=0;if(r=t.xoff,null==r)return;a=t.yoff;for(var I=0,k=-1,T=0;f>T;T++){for(var z=0;i>z;z++){var q=b*T+(z>>5),D=d[(a+T)*(v<<5)+(r+z)<<2]?1<<31-z%32:0;M[q]|=D,I|=D}I?k=T:(t.y0++,f--,T--,a++)}t.y1=t.y0+k,t.sprite=M.slice(0,(t.y1-t.y0)*b)}}}function s(t,n,e){e>>=5;for(var r,a=t.sprite,u=t.width>>5,o=t.x-(u<<4),i=127&o,f=32-i,s=t.y1-t.y0,l=(t.y+t.y0)*e+(o>>5),c=0;s>c;c++){r=0;for(var h=0;u>=h;h++)if((r<<f|(u>h?(r=a[c*u+h])>>>i:0))&n[l+h])return!0;l+=e}return!1}function l(t,n){var e=t[0],r=t[1];n.x+n.x0<e.x&&(e.x=n.x+n.x0),n.y+n.y0<e.y&&(e.y=n.y+n.y0),n.x+n.x1>r.x&&(r.x=n.x+n.x1),n.y+n.y1>r.y&&(r.y=n.y+n.y1)}function c(t,n){return t.x+t.x1>n[0].x&&t.x+t.x0<n[1].x&&t.y+t.y1>n[0].y&&t.y+t.y0<n[1].y}function h(t){var n=t[0]/t[1];return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function y(t){var n=4,e=n*t[0]/t[1],r=0,a=0;return function(t){var u=0>t?-1:1;switch(Math.sqrt(1+4*u*t)-u&3){case 0:r+=e;break;case 1:a+=n;break;case 2:r-=e;break;default:a-=n}return[r,a]}}function x(t){for(var n=[],e=-1;++e<t;)n[e]=0;return n}var d,g=Math.PI/180,v=64,m=2048,p=1;if("undefined"!=typeof document)d=document.createElement("canvas"),d.width=1,d.height=1,p=Math.sqrt(d.getContext("2d").getImageData(0,0,1,1).data.length>>2),d.width=(v<<5)/p,d.height=m/p;else{var M=require("canvas");d=new M(v<<5,m)}var w=d.getContext("2d"),b={archimedean:h,rectangular:y};w.fillStyle=w.strokeStyle="red",w.textAlign="center",t.cloud=n}("undefined"==typeof exports?d3.layout||(d3.layout={}):exports);